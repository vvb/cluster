##Ansible variables used during provisioning

This file lists the ansible variables that can be passed at the time of commissioning a node or at a global level as described in [README.md](./README.md#commision-a-node). The variables specified at global level are merged with variables specified at time of commissioning a node with latter taking precedence over the former in case of a overlap/conflict.

Setting the variable at a global level that has same value across all nodes in a cluster, can substantially reduce the amount of variables that need to specified at every node commision and is a recommended way to set the variables when possible.

The rest of this document is split into two sections viz. *Mandatory variables* and *Commonly used variables*. *Mandatory variables* lists the variables that must be set before a node can be configured. *Commonly used variables* lists the variables that we would use to affect the default ansible behavior like deploying a specific scheduler stack or a specific networking stack.

There are several variables that are made available to provide a good level of programmability in the ansible plays and the reader is encouraged to look at the plays in [vendor/ansible](../vendor/ansible)

###Mandatory variables
- **env** is used to set the environment variables that need to be available to ansible tasks. A common usecase of this variable is to set the http-proxy info.
  - **env** is specified as a JSON dictionary. 
  ```
  {"env": { "var1": "val1"}}
  ```
  - It should be set to empty dictionary if no environment variables needs to be set.
  ```
  {"env": {}}
  ```
- **control_interface** identifies the netdevice on the node that will carry the traffic generated by infrastructure applications like etcd, ceph and so on.
  - **control_interface** is specified as a JSON string
  ```
  {"control_interface": "eth1"}
  ```
- **netplugin_if** identifies the netdevice on the node that will carry the data traffic generated by the containers netwroked using contiv data plane.
  - **netplugin_if** is specified as a JSON string
  ```
  {"netplugin_if": "eth2"}
  ```
- **service_vip** identies an available static IP address that can be used as a virtual ip to provide reachability for contiv services.
  - **service_vip** is specified as a JSON string
  ```
  {"service_vip": "192.168.2.252"}
  ```

###Optional/Commonly used variables
- **scheduler_provider** identifies the scheduler stack to use. We support two stacks viz. `native-swarm` and `ucp-swarm`. The first brings-up a swarm cluster using the stock swarm image from dockerhub. The seconds brings-up a ucp cluster which bundles swarm in it.
  - **scheduler_provider** is specified as a JSON string
  ```
  {"scheduler_provider": "ucp-swarm"}
  ```
  - **ucp_bootstrap_node_name** identifies the name (as seen in `clusterctl nodes get` command) of the node to bootstrap ucp with. This is the first node that is commissioned in the cluster. This is mandatory when **scheduler_provider** was set to `ucp-swarm`
    - **ucp_bootstrap_node_name** is specified as a JSON string
  ```
  {"ucp_bootstrap_node_name": "cluster-node1-0"}
  ```
- **contiv_network_mode** identifies the mode of operation for netplugin. Netplugin supports two modes viz. `aci` and `standalone`. The first is used to bring-up netplugin in a Cisco APIC managed fabric deployment, while the second mode can be used when deploying netplugin with standalone Layer2/Layer3 switches.
  - **contiv_network_mode** is specified as a JSON string
  ```
  {"contiv_network_mode": "aci"}
  ```
  **Following are the relevant variables when `contiv_network_mode` is set to `aci`**
  - **apic_url** specifies the url for APIC. This is a mandatory variable in aci mode.
    - **apic_url** is specified as a JSON string
    ```
    {"apic_url": "https://<apic-server-url>:443"}
    ```
  - **apic_username** specifies the username for APIC. This is a mandatory variable in aci mode.
    - **apic_username** is specified as a JSON string
    ```
    {"apic_username": "my-user"}
    ```
  - **apic_password** specifies the password for APIC. This is a mandatory variable in aci mode.
    - **apic_password** is specified as a JSON string
    ```
    {"apic_password": "my-password"}
    ```
  - **apic_leaf_nodes** specifies full path of the leaf nodes connected managed by APIC. This is a mandatory variable in aci mode.
    - **apic_leaf_nodes** is specified as a JSON string
    ```
    {"apic_leaf_nodes": "topology/pod-1/node-101,topology/pod-1/node-102"}
    ```
  - **apic_phys_domain** specifies the name of the physical domain name created in APIC.
    - **apic_phys_domain** is specified as a JSON string
    ```
    {"apic_phys_domain": "allVlans"}
    ```
  - **apic_epg_bridge_domain** can be optionally used to provide a pre-created bridge domain. The bridge domain should have  already been created under tenant `common`.
    - **apic_epg_bridge_domain** is specified as a JSON string
    ```
    {"apic_epg_bridge_domain": "my-bd"}
    ```
  - **apic_contracts_unrestricted_mode** can be optionally used to allow unrestricted communication between EPGs. 
    - **apic_contracts_unrestricted_mode** is specified as a JSON string
    ```
    {"apic_contracts_unrestricted_mode": "yes"}
    ```
  **Following are the relevant variables when `contiv_network_mode` is set to `standalone`**
  - **fwd_mode** specifies whether netplugin shall bridge or route the packet. Netplugin supports two forwarding modes viz. `bridge` and `routing`.
    - **fwd_mode** is specified as a JSON string
    ```
    {"fwd_mode": "routing"}
    ```
